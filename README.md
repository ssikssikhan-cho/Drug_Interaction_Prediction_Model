Drug_Interaction_Prediction_Model
=================================

### 약물 혼합복용시 부자용을 예측하는 모델입니다.
### DATA SET 은 DUR(식약품 안전사용 서비스)에서 추출하였으며, 메타데이터의 양은 대략 70만개 입니다.

#### 데이터 전처리 과정
1. 중복 데이터 처리
    * A. 성분 및 제품명은 같지만, 제조사가 다른 경우
    * B. 성분, 제품명 및 제조사가 같지만, 국내용 수출용으로 나누어져 있는경우

2. 작성자에 따라 다른 형식의 부작용
    * A. 해당 데이터들은 자연어처리로 진행하였으며, 데이터가 분포가 고르지 않아 문장으로 서술된 부작용을 카테고리 형식으로 변환하였습니다.
    * B. 문장을 토큰화 하여 조사, 접속사 등을 제거하여 단어만을 추출하였습니다.
    * C. 이후 텍스트 유사도를 거쳐 카테고리를 완성 하였습니다.
    * D. 카테고리 나누는 학습과정에서 가중치가 매우 적어 분류를 하지 못할경우 "기타 부작용" 이라는 카테고리로 분류 하였습니다.
    * E. "기타 부작용" 의 경우 직접 카테고리를 생성하거나, 직접 카테고리 재분류 과정을 거쳐 데이터셋을 완성 하였습니다.


#### 전처리 된 데이터를 모델에 적용
1. 첫번째 20만개 정도의 데이터셋(데이터셋 A)에 대해 전처리를 거쳐 학습을 진행하였습니다.
2. 카테고리가 설정안된 15만개 데이터셋 2개(데이터셋 B, C)에 대해 학습된 모델이 직접 카테고리를 작성하도록 하였습니다.
3. 데이터셋 B, C 는 데이터셋 A와 각각 14.5만 14.9만 개의 데이터가 겹칩니다. 따라서 온전한 예측 데이터는 약 6천개의 데이터가 존재했습니다.
4. 학습된 모델이 직접 카테고리를 결정한 6천개의 데이터에 대해서는 직접 수기로 확인하였습니다.
5. 6천개의 데이터에 대한 정확도는 95.5% 입니다.

#### 모델에 대한 설명
1. 학습 데이터셋 설정 및 SMOTE 적용
    * A. 데이터셋 A의 성분명과 성분코드를 입력변수 X 로 설정, 질병 분류를 출력 변수 y 로 설정 하였습니다.
    * B. 테스트 데이터셋는 20%로 설정하고, 학습 데이터 셋 80% 설정 하였습니다.
    * C. 데이터셋은 부작용에 대한 값들이 불균형 데이터셋이므로 SMOTE 기법을 사용하여 소수 클래스 데이터를 증강했습니다.

2. Random Forest 모델 학습 및 최적의 하이퍼파라미터 탐색
    * A.학습 데이터 셋에 대해 Random Forest 모델을 적용하여 분류하였습니다.
    * B. 하이퍼파라미터 최적화를 위해 GridSearchCV를 사용하였으며, n_estimators, max_depth, min_samples_split 다양한 매개변수 조합을 시도하여 가장 성능이 좋은 모델을 찾는 코드로 작성하였습니다.
    * C. 최적의 모델로 테스트 데이터셋에 대해 예측을 수행하였습니다.

3. 성능 평가 및 파일 B 예측
    * A. 테스트 데이터 셋에 대해 예측한 결과를 classification report로 평가하였습니다. 각 클래스별 precision, recall, F1-score를 확인하였습니다.
    * B. zero_division=1 옵션을 사용하여 결과 값이 없는 경우 1로 처리하였습니다.
    * C. 데이터 셋 A 자체에서의 학습 및 예측 성능 평가 지표는 아래에 삽입하였습니다.
    * D. 데이터 셋 B 에는 질병카테고리가 없었기 때문에 학습된 모델을 이용해 질병을 예측한 후 결과를 결합하여 return 하였습니다.

```
카테고리                     precision    recall  f1-score   support(실제 데이터 수)

간 관련                       0.96      0.90      0.93      3690
독성 관련                     0.56      0.67      0.61        78
복합 부작용                   1.00      1.00      1.00       121
위장 관련                     1.00      0.99      0.99        91
혈압 관련                     0.97      1.00      0.98       212
신장 관련                     0.61      0.80      0.69       737
혈중농도 관련                 0.99      1.00      0.99       280
심장 관련                     1.00      0.99      0.99       610
세로토닌성 증후군 관련         0.67      1.00      0.80        10
근육 관련                     1.00      1.00      1.00       135
혈장농도 관련                 1.00      0.95      0.98        62
신경계 관련                   0.99      0.96      0.98       142
기타 일반 부작용              0.89      1.00      0.94        17
혈액독성 관련                 0.58      0.51      0.54        98
혈액 관련                     0.56      0.47      0.51        19
혈관 관련                     1.00      1.00      1.00        29
세로토닌 증후군 관련           1.00      1.00      1.00        28
바이러스 관련                 0.90      0.98      0.93        44
진통효과 관련                 1.00      1.00      1.00        35
경련 관련                     1.00      1.00      1.00         3
출혈 관련                     1.00      1.00      1.00        28
전해질 관련                   1.00      1.00      1.00        11
감염 관련                     1.00      1.00      1.00        20
고혈압 관련                   1.00      0.93      0.97        15
뇌 관련                      1.00      1.00      1.00         2
 
accuracy(정확도)                                  0.91      
macro avg(평균성능)            0.91      0.93      0.91      
weighted avg(가중 평균 성능)    0.92      0.91      0.91     
```